{% extends 'frontend/layouts/base.html' %}

{% block content %}
{% load static %}
    <!-- Breadcrumb -->
    <section class="breadcrumb-section border-top">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}"><i class="fas fa-home"></i> Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Shop</li>
                </ol>
            </nav>
        </div>
    </section>

    {% if category and show_all and category.subcategories.exists %}
    <section class="subcategories-section py-4">
        <div class="container text-center">
            {% for sub in category.subcategories.all %}
                <a href="{% url 'category' sub.category_slug %}" class="btn btn-md btn-outline-secondary mx-1 mb-1">
                    {{ sub.category }}
                </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- Product Display -->
    <section class="product-section">
        <div class="container">
            <h2 class="section-title fade-in">Products</h2>
            <!-- Filter -->
            <div class="filter-bar">
                <div class="showing-text">
                    Showing {{ products.count }} product{{ products.count|pluralize }}
                </div>
                <div class="sort-dropdown">
                    <label for="sortSelect">Sort by:</label>
                    <select id="sortSelect" class="form-select-sm" onchange="location = this.value;">
                        <option value="{% url 'all_products' %}" {% if not sort %}selected{% endif %}>Default</option>
                        <option value="{% url 'all_products' %}?sort=price&direction=asc"
                            {% if sort == "price" and direction == "asc" %}selected{% endif %}>
                            Price: Low to High
                        </option>
                        <option value="{% url 'all_products' %}?sort=price&direction=desc"
                            {% if sort == "price" and direction == "desc" %}selected{% endif %}>
                            Price: High to Low
                        </option>
                        <option value="{% url 'all_products' %}?sort=rating&direction=desc"
                            {% if sort == "rating" and direction == "desc" %}selected{% endif %}>
                            Rating: High to Low
                        </option>
                        <option value="{% url 'all_products' %}?sort=category&direction=asc"
                            {% if sort == "category" and direction == "asc" %}selected{% endif %}>
                            Name: A to Z
                        </option>
                        <option value="{% url 'all_products' %}?sort=category&direction=desc"
                            {% if sort == "category" and direction == "desc" %}selected{% endif %}>
                            Name: Z to A
                        </option>
                    </select>
                </div>
            </div>

            <div class="row g-4">
                {% for product in products %}
                <div class="col-lg-3 col-md-6">
                    <div class="product-card fade-in">
                        <a href="{% url 'product_detail' product.product_slug %}">
                            {% if product.thumbnail %}
                                <img src="{{ product.thumbnail.url }}" class="product-img" alt="{{ product.product_name }}">
                            {% elif product.image_url %}
                                <img src="{{ product.image_url }}" class="product-img" alt="{{ product.product_name }}">
                            {% else %}
                                <img src="{% static 'assets/images/default.jpg' %}" class="product-img" alt="No Image">
                            {% endif %}
                        </a>

                        <div class="product-info">
                            {% if product.category %}
                                <p class="product-category text-muted">
                                    {{ product.category.category }}
                                </p>
                            {% endif %}
                           <h5 class="product-title">
                                <a href="{% url 'product_detail' product.product_slug %}">
                                    {{ product.product_name }}
                                </a>
                            </h5>

                            {% if product.rating %}
                            <div class="product-rating">
                                <div class="rating-stars">
                                    {% for i in "12345" %}
                                        {% with star=forloop.counter %}
                                            {% if product.rating >= star %}
                                                <i class="fas fa-star"></i>
                                            {% elif product.rating >= star|add:"-0.5" %}
                                                <i class="fas fa-star-half-alt"></i>
                                            {% else %}
                                                <i class="far fa-star"></i>
                                            {% endif %}
                                        {% endwith %}
                                    {% endfor %}
                                </div>
                                <span class="rating-text">{{ product.rating }}/5</span>
                            </div>
                            {% endif %}


                            <p class="product-description">
                                {{ product.short_description|default:"No description available."|truncatewords:10 }}
                            </p>

                            <div class="product-footer">
                                <div class="product-price">${{ product.price }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p>No products available.</p>
                {% endfor %}
            </div>
        </div>
    </section>

{% endblock %}